<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sarp Kantman | Ke≈üif Paneli</title>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&family=Fauna+One&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        * { margin: 0; padding: 0; }
        html, body { width: 100%; height: 100%; background: #fdfaf3; }
        
        #map {
            width: 100%;
            height: 100%;
            position: fixed;
            top: 0;
            left: 0;
            z-index: 1;
        }

        .landing-container {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100%;
            max-width: 800px;
            padding: 20px;
            text-align: center;
            z-index: 500;
            pointer-events: none;
            background: rgba(10, 10, 10, 0.25);
            border-radius: 8px;
            backdrop-filter: blur(8px);
        }

        .landing-container > * { pointer-events: auto; }

        .main-title {
            font-family: 'Cinzel', serif;
            font-size: 3.5rem;
            letter-spacing: 10px;
            color: #fff;
            margin-bottom: 10px;
            text-shadow: 0 0 30px rgba(0,0,0,0.8), 0 0 20px rgba(196, 164, 132, 0.5);
        }

        .tagline {
            font-family: 'Cinzel', serif;
            font-size: 1rem;
            letter-spacing: 3px;
            color: #d4af37;
            margin-bottom: 30px;
            opacity: 0.95;
            text-transform: uppercase;
            text-shadow: 0 0 15px rgba(0,0,0,0.8);
        }

        .detail-card {
            background: rgba(10, 10, 10, 0.98);
            border: 2px solid #d4af37;
            padding: 30px 40px;
            border-radius: 4px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.9);
            backdrop-filter: blur(15px);
        }

        .detail-card p {
            font-size: 0.95rem;
            color: #ffffff;
            line-height: 1.6;
            font-family: 'Fauna One', serif;
        }

        .button-group {
            margin-top: 25px;
            display: flex;
            gap: 12px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .explore-btn {
            background: #8b0000;
            color: #fff;
            border: 2px solid #d4af37;
            padding: 12px 30px;
            font-family: 'Cinzel';
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.4s ease;
            text-decoration: none;
            display: inline-block;
            letter-spacing: 1px;
        }

        .explore-btn:hover:not(:disabled) {
            background: #d4af37;
            color: #000;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(212, 175, 55, 0.3);
        }

        .explore-btn:active {
            transform: translateY(0);
        }

        /* Marker styles */
        @keyframes heartbeat {
            0%, 100% { transform: scale(1); }
            25% { transform: scale(1.2); }
            50% { transform: scale(1); }
        }

        .custom-marker .marker-pin {
            font-size: 20px;
            line-height: 1;
            color: #8b0000;
            text-shadow: 0 1px 0 rgba(255,255,255,0.6), 0 2px 6px rgba(0,0,0,0.15);
            transform: translateY(-2px);
            display: inline-block;
            animation: heartbeat 1.5s ease-in-out infinite;
        }
        .custom-marker { transform: translate(-50%, -100%); }

        /* Responsive */
        @media (max-width: 768px) {
            .main-title { font-size: 2.5rem; letter-spacing: 6px; }
            .tagline { font-size: 0.85rem; letter-spacing: 2px; }
            .detail-card { padding: 20px 25px; }
            .explore-btn { padding: 10px 20px; font-size: 0.9rem; }
            .button-group { gap: 8px; }
        }

        @media (max-width: 640px) {
            .landing-container { width: 92%; padding: 16px; }
            .detail-card { padding: 16px 18px; }
            .button-group { flex-direction: column; }
            .explore-btn { width: 100%; }
        }

        @media (max-height: 700px) {
            .landing-container { top: 46%; }
        }

        @media (max-width: 480px) {
            .main-title { font-size: 2rem; letter-spacing: 4px; }
            .tagline { font-size: 0.75rem; }
            .detail-card { padding: 15px 20px; }
            .explore-btn { padding: 10px 16px; font-size: 0.85rem; }
        }
    </style>
</head>
<body>
    <div id="map"></div>

    <div class="landing-container">
        <header>
            <h1 class="main-title">KE≈ûƒ∞F PANELƒ∞</h1>
            <p class="tagline">Dijital Varlƒ±klarƒ±n G√∂r√ºnmez ƒ∞zleri</p>
        </header>

        <div class="detail-card">
            <p>"Tarihsiz coƒürafya, hareketsiz bir ceset gibidir; coƒürafyasƒ±z tarih ise belli bir yurdu olmayan bir avare gibi ba≈üƒ±bo≈ü gezer." <span style="color:#d4af37;font-family:'Cinzel';">- John Smith</span></p>
        </div>

        <div class="button-group">
            <button onclick="runDiscovery()" class="explore-btn" id="actionBtn">KE≈ûFE BA≈ûLA</button>
            <a href="frontend/map.html" class="explore-btn">T√úRKƒ∞YE</a>
            <a href="frontend/posts.html" class="explore-btn">SON PAYLA≈ûIMLAR</a>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // Initialize map
        var map = L.map('map', {
            zoomControl: false,
            dragging: true,
            touchZoom: true,
            scrollWheelZoom: true
        }).setView([39.0, 35.2], 6);

        L.control.zoom({ position: 'bottomright' }).addTo(map);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

        var markers = [];
        var posts = [];

        // HTML to text converter
        function htmlToText(html){
            const div = document.createElement('div');
            div.innerHTML = html || '';
            return div.textContent || div.innerText || '';
        }

        // Load WordPress posts and render markers
        async function loadPostsAndMarkers() {
            try {
                const response = await fetch('https://sarpkantman.com/wp-json/wp/v2/posts?per_page=100&_fields=id,title,excerpt,content,meta,link,date');
                let wpPosts = await response.json();

                if (wpPosts && Array.isArray(wpPosts) && wpPosts.length > 0) {
                    wpPosts = wpPosts.map((post, index) => ({
                        ...post,
                        wp_id: post.id,
                        id: 100 + index,
                        latitude: post.meta?.latitude || null,
                        longitude: post.meta?.longitude || null,
                        location: post.meta?.location || post.meta?.country || null
                    }));

                    // Doƒüru konum e≈ülemesi - ba≈ülƒ±klara g√∂re
                    const locationMap = {
                        "Corleone": { location: "Corleone, Sicilya, ƒ∞talya", latitude: 37.7722, longitude: 13.3055 },
                        "Rashid": { location: "Rashid, Mƒ±sƒ±r", latitude: 31.2753, longitude: 30.4265 },
                        "Konfederasyon Antietam": { location: "Maryland, ABD (Antietam Muharebe Alanƒ±)", latitude: 39.2704, longitude: -77.7338 },
                        "Etr√ºskler": { location: "Toskana/Lazio B√∂lgesi, ƒ∞talya", latitude: 42.5, longitude: 12.0 },
                        "Hiper-Karma≈üƒ±klƒ±ƒüƒ±n Bedeli": { location: "Doƒüu Akdeniz Havzasƒ±", latitude: 36.5, longitude: 30.0 },
                        "Le Grand Bleu": { location: "Amorgos Adasƒ±, Yunanistan", latitude: 36.8327, longitude: 25.8827 },
                        "ƒ∞skenderiye'de Zamanƒ±n Tanrƒ±sƒ±": { location: "ƒ∞skenderiye, Mƒ±sƒ±r", latitude: 31.2001, longitude: 29.9187 },
                        "Kom el Shoqafa": { location: "ƒ∞skenderiye, Mƒ±sƒ±r", latitude: 31.2001, longitude: 29.9187 },
                        "T√ºylerimizi Diken Diken": { location: "Evrensel", latitude: 0, longitude: 0 },
                        "Appalachian Gothic": { location: "Appala≈ü Daƒülarƒ±, Doƒüu ABD", latitude: 37.5, longitude: -82.5 },
                        "Grizzly Man": { location: "Katmai Ulusal Parkƒ±, Alaska, ABD", latitude: 58.5, longitude: -155.3 },
                        "ƒ∞ngiliz Kooperatifi": { location: "Kadƒ±k√∂y, ƒ∞stanbul, T√ºrkiye", latitude: 40.9913, longitude: 29.0214 },
                        "Tsavo": { location: "Tsavo Nehri B√∂lgesi, Kenya", latitude: -3.4, longitude: 38.8 },
                        "Korku Sinemasƒ±": { location: "Evrensel", latitude: 0, longitude: 0 },
                        "√áaykovski": { location: "Votkinsk/St. Petersburg, Rusya", latitude: 57.1939, longitude: 30.2642 },
                        "Dr. Seuss": { location: "Springfield, Massachusetts, ABD", latitude: 42.1015, longitude: -72.5898 },
                        "Polar Gigantism": { location: "Arktik ve Antarktika", latitude: 70.0, longitude: 0.0 },
                        "Wes Anderson": { location: "New York City, ABD", latitude: 40.7128, longitude: -74.0060 },
                        "Wardruna": { location: "Bergen, Norve√ß", latitude: 60.3913, longitude: 5.3221 },
                        "Boƒüazi√ßi": { location: "ƒ∞stanbul, T√ºrkiye", latitude: 41.0082, longitude: 28.9784 },
                        "Serafim'in Kanatlarƒ±nda": { location: "Halep, Suriye / ƒ∞stanbul, T√ºrkiye", latitude: 34.7315, longitude: 36.2384 },
                        "Morna": { location: "Mindelo, Ye≈üil Burun Adalarƒ±", latitude: 16.8829, longitude: -24.6605 },
                        "Tarih Boyunca Kƒ±lƒ±cƒ±n": { location: "Evrensel", latitude: 0, longitude: 0 },
                        "Kyliks": { location: "Atina, Yunanistan / Vatikan M√ºzeleri", latitude: 37.9838, longitude: 23.7275 },
                        "ƒ∞stanbul ve Kediler": { location: "ƒ∞stanbul, T√ºrkiye", latitude: 41.0082, longitude: 28.9784 },
                        "Attu Station": { location: "Aleut Adalarƒ±, Alaska, ABD", latitude: 52.9385, longitude: -173.1984 },
                        "G√∂lgeden K√ºlt√ºre": { location: "Paris, Fransa", latitude: 48.8566, longitude: 2.3522 },
                        "Tablolarƒ±n Ardƒ±ndaki Gizem": { location: "Floransa/Paris/Roma", latitude: 43.7696, longitude: 11.2558 },
                        "≈ûeytanƒ±n Akordu": { location: "Mississippi Deltasƒ±, ABD", latitude: 32.3792, longitude: -90.1848 },
                        "Zihinle Evrune": { location: "Atina, Yunanistan", latitude: 37.9838, longitude: 23.7275 },
                        "Bir Nehir, Bir C√ºmle": { location: "Rubicon Nehri, Kuzey ƒ∞talya", latitude: 44.0, longitude: 12.6 },
                        "ƒ∞sa'dan √ñnce Roma": { location: "Kud√ºs ve Roma", latitude: 41.9028, longitude: 12.4964 },
                        "Normandiya": { location: "Normandiya, Fransa", latitude: 49.3530, longitude: -0.5898 },
                        "Leedsichthys": { location: "Peterborough, ƒ∞ngiltere", latitude: 52.5707, longitude: -0.2447 },
                        "Zdzis≈Çaw Beksi≈Ñski": { location: "Sanok/Var≈üova, Polonya", latitude: 52.2297, longitude: 21.0122 },
                        "Shadow Wolves": { location: "Tohono O'odham Topraklarƒ±, Arizona, ABD", latitude: 32.2326, longitude: -111.0806 },
                        "Kim Jong-il": { location: "Pyongyang, Kuzey Kore", latitude: 39.0194, longitude: 125.7482 },
                        "Nazi U-Bootlarƒ±": { location: "Atlantik Okyanusu", latitude: 30.0, longitude: -40.0 },
                        "Louisiana Blues": { location: "Louisiana, ABD", latitude: 31.1695, longitude: -91.8749 },
                        "Neandertal": { location: "Krapina, Hƒ±rvatistan / Los Aviones Maƒüarasƒ±, ƒ∞spanya", latitude: 46.2031, longitude: 15.8191 },
                        "Country": { location: "Austin, Teksas / Nashville, Tennessee, ABD", latitude: 36.1627, longitude: -86.7816 },
                        "Ben Sana Mecburum": { location: "ƒ∞stanbul, T√ºrkiye", latitude: 41.0082, longitude: 28.9784 },
                        "ƒ∞stanbul'un ƒ∞l√ßeleri": { location: "ƒ∞stanbul, T√ºrkiye", latitude: 41.0082, longitude: 28.9784 },
                        "Marcus Aurelius": { location: "Roma, ƒ∞talya", latitude: 41.9028, longitude: 12.4964 },
                        "Cezzar Ahmet Pa≈üa": { location: "Akka, Filistin / ƒ∞stanbul, T√ºrkiye", latitude: 32.9254, longitude: 35.0818 },
                        "B√ºy√ºk ƒ∞skender": { location: "Bergama, T√ºrkiye / Atina, Yunanistan", latitude: 39.1258, longitude: 27.1848 },
                        "Pan Heykeli": { location: "Tƒ±rnovo, Bulgaristan / ƒ∞stanbul Arkeoloji M√ºzesi", latitude: 43.1975, longitude: 25.3192 },
                        "Theodosius": { location: "Sultanahmet, ƒ∞stanbul, T√ºrkiye", latitude: 41.0054, longitude: 28.9769 },
                        "Yoros Kalesi": { location: "Anadolu Kavaƒüƒ±, Beykoz, ƒ∞stanbul, T√ºrkiye", latitude: 41.1516, longitude: 29.1648 },
                        "Franz Liszt": { location: "Beyoƒülu, ƒ∞stanbul, T√ºrkiye", latitude: 41.0373, longitude: 28.9754 },
                        "ƒ∞shak Aƒüa": { location: "Beykoz, ƒ∞stanbul, T√ºrkiye", latitude: 41.1516, longitude: 29.0286 },
                        "Mehmet Keth√ºda": { location: "Be≈üikta≈ü, ƒ∞stanbul, T√ºrkiye", latitude: 41.0429, longitude: 29.0029 },
                        "Merkez Efendi": { location: "Zeytinburnu, ƒ∞stanbul, T√ºrkiye", latitude: 40.9839, longitude: 28.8965 },
                        "√ñrme Dikilita≈ü": { location: "Sultanahmet, ƒ∞stanbul, T√ºrkiye", latitude: 41.0054, longitude: 28.9769 },
                        "Sultan Ahmet Sebili": { location: "Sultanahmet, ƒ∞stanbul, T√ºrkiye", latitude: 41.0054, longitude: 28.9769 },
                        "Yahya Efendi": { location: "Be≈üikta≈ü, ƒ∞stanbul, T√ºrkiye", latitude: 41.0429, longitude: 29.0029 },
                        "Nazƒ±r ƒ∞smail": { location: "Sultanahmet, ƒ∞stanbul, T√ºrkiye", latitude: 41.0054, longitude: 28.9769 },
                        "Brezilya": { location: "Rio de Janeiro, Brezilya", latitude: -22.9068, longitude: -43.1729 },
                        "Buena Vista": { location: "Havana, K√ºba", latitude: 23.1291, longitude: -82.3794 },
                        "Selami√ße≈üme": { location: "Kadƒ±k√∂y, ƒ∞stanbul, T√ºrkiye", latitude: 40.9913, longitude: 29.0214 },
                        "Markiz ve Lebon": { location: "ƒ∞stiklal Caddesi, Beyoƒülu, ƒ∞stanbul, T√ºrkiye", latitude: 41.0373, longitude: 28.9754 },
                        "Strigilis": { location: "ƒ∞stanbul Arkeoloji M√ºzesi", latitude: 41.0137, longitude: 28.9839 },
                        "H√ºseyin Nihal": { location: "Karacaahmet Mezarlƒ±ƒüƒ±, √úsk√ºdar, ƒ∞stanbul, T√ºrkiye", latitude: 41.0216, longitude: 29.0271 },
                        "Desafinado": { location: "Rio de Janeiro, Brezilya", latitude: -22.9068, longitude: -43.1729 },
                        "Tombak At": { location: "Askeri M√ºze, ƒ∞stanbul / Topkapƒ± Sarayƒ±", latitude: 41.0137, longitude: 28.9839 },
                        "Caligula": { location: "Assos (Behramkale), √áanakkale, T√ºrkiye", latitude: 39.5764, longitude: 26.3622 },
                        "Villa Mon Plasir": { location: "Fenerbah√ße, Kadƒ±k√∂y, ƒ∞stanbul, T√ºrkiye", latitude: 40.9736, longitude: 29.0303 },
                        "ƒ∞stanbul Siluet": { location: "ƒ∞stanbul, T√ºrkiye", latitude: 41.0082, longitude: 28.9784 },
                        "R√ºstem Pa≈üa": { location: "Emin√∂n√º, Fatih, ƒ∞stanbul, T√ºrkiye", latitude: 41.0166, longitude: 28.9703 },
                        "Marmara Denizi": { location: "Marmara Denizi / ƒ∞stanbul, T√ºrkiye", latitude: 40.8, longitude: 28.5 },
                        "ƒ∞skender Lahdi": { location: "ƒ∞stanbul Arkeoloji M√ºzesi", latitude: 41.0137, longitude: 28.9839 }
                    };

                    wpPosts.forEach((post) => {
                        const title = post.title?.rendered || '';
                        let foundLocation = null;

                        // Ba≈ülƒ±ƒüa g√∂re konum ara
                        for (const [key, loc] of Object.entries(locationMap)) {
                            if (title.includes(key)) {
                                foundLocation = loc;
                                break;
                            }
                        }

                        if (foundLocation) {
                            post.location = foundLocation.location;
                            post.latitude = foundLocation.latitude;
                            post.longitude = foundLocation.longitude;
                        } else if (!post.location || !post.latitude || !post.longitude) {
                            // Eƒüer e≈ü bir konum bulunamazsa, varsayƒ±lan olarak ƒ∞stanbul'u kullan
                            post.location = 'ƒ∞stanbul, T√ºrkiye';
                            post.latitude = 41.0082;
                            post.longitude = 28.9784;
                        }
                    });

                    posts = wpPosts;
                } else {
                    // Fallback posts
                    posts = [
                        {
                            id: 1,
                            title: { rendered: 'Corleone' },
                            location: 'Corleone, Sicilya, ƒ∞talya',
                            latitude: 37.7722,
                            longitude: 13.3055
                        },
                        {
                            id: 2,
                            title: { rendered: 'Rashid' },
                            location: 'Rashid, Mƒ±sƒ±r',
                            latitude: 31.2753,
                            longitude: 30.4265
                        }
                    ];
                }
            } catch (err) {
                console.error("Posts load error:", err);
                posts = [
                    {
                        id: 1,
                        title: { rendered: 'Corleone' },
                        location: 'Corleone, Sicilya, ƒ∞talya',
                        latitude: 37.7722,
                        longitude: 13.3055
                    },
                    {
                        id: 2,
                        title: { rendered: 'Rashid' },
                        location: 'Rashid, Mƒ±sƒ±r',
                        latitude: 31.2753,
                        longitude: 30.4265
                    }
                ];
            }

            renderMarkers();

            // Yunan ve Roma eserleri de y√ºkle ve g√∂ster
            try {
                const ancientResponse = await fetch('data/ancient-sites.json');
                if (ancientResponse.ok) {
                    const ancientSites = await ancientResponse.json();
                    renderAncientSiteMarkers(ancientSites);
                }
            } catch (err) {
                console.error("Ancient sites load error:", err);
            }
        }

        function renderMarkers() {
            markers.forEach(m => map.removeLayer(m));
            markers = [];

            posts.forEach(post => {
                const latitude = post.latitude || post.meta?.latitude;
                const longitude = post.longitude || post.meta?.longitude;

                if (latitude && longitude) {
                    const titleText = htmlToText(post.title?.rendered || '');
                    const icon = L.divIcon({ 
                        className: 'custom-marker', 
                        html: `<div class="marker-pin" title="${titleText}">üìç</div>` 
                    });
                    var marker = L.marker([latitude, longitude], { icon: icon }).addTo(map);
                    markers.push(marker);
                }
            });
        }

        function renderAncientSiteMarkers(sites) {
            sites.forEach(site => {
                if (site.latitude && site.longitude) {
                    let markerChar = 'üèõÔ∏è';
                    let markerColor = '#8b0000';
                    
                    if (site.type.includes('Greek')) {
                        markerColor = '#0066cc';
                        markerChar = 'üèõÔ∏è';
                    } else if (site.type.includes('Roman')) {
                        markerColor = '#cc6600';
                        markerChar = '‚öîÔ∏è';
                    }
                    
                    const icon = L.divIcon({
                        className: 'ancient-marker',
                        html: `<div style="font-size:18px; color:${markerColor}; text-shadow:0 1px 3px rgba(0,0,0,0.3);">${markerChar}</div>`,
                        iconSize: [25, 25],
                        iconAnchor: [12, 25]
                    });
                    
                    const marker = L.marker([site.latitude, site.longitude], { icon: icon }).addTo(map);
                }
            });
        }

        function runDiscovery(){
            // Redirect to map page
            window.location.href = 'frontend/caesar.html';
        }

        // Load posts on page init
        loadPostsAndMarkers();
    </script>
</body>
</html>