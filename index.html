<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sarp Kantman | Ke≈üif Paneli</title>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&family=Fauna+One&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        * { margin: 0; padding: 0; }
        html, body { width: 100%; height: 100%; }
        
        #map {
            width: 100%;
            height: 100%;
            position: fixed;
            top: 0;
            left: 0;
            z-index: 1;
        }

        .landing-container {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100%;
            max-width: 800px;
            padding: 20px;
            text-align: center;
            z-index: 500;
            pointer-events: none;
            background: rgba(10, 10, 10, 0.25);
            border-radius: 8px;
            backdrop-filter: blur(8px);
        }

        .landing-container > * { pointer-events: auto; }

        .main-title {
            font-family: 'Cinzel', serif;
            font-size: 3.5rem;
            letter-spacing: 10px;
            color: #fff;
            margin-bottom: 10px;
            text-shadow: 0 0 30px rgba(0,0,0,0.8), 0 0 20px rgba(196, 164, 132, 0.5);
        }

        .tagline {
            font-family: 'Cinzel', serif;
            font-size: 1rem;
            letter-spacing: 3px;
            color: #d4af37;
            margin-bottom: 30px;
            opacity: 0.95;
            text-transform: uppercase;
            text-shadow: 0 0 15px rgba(0,0,0,0.8);
        }

        .detail-card {
            background: rgba(10, 10, 10, 0.98);
            border: 2px solid #d4af37;
            padding: 30px 40px;
            border-radius: 4px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.9);
            backdrop-filter: blur(15px);
        }

        .detail-card p {
            font-size: 0.95rem;
            color: #ffffff;
            line-height: 1.6;
            font-family: 'Fauna One', serif;
        }

        .button-group {
            margin-top: 25px;
            display: flex;
            gap: 12px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .explore-btn {
            background: #8b0000;
            color: #fff;
            border: 2px solid #d4af37;
            padding: 12px 30px;
            font-family: 'Cinzel';
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.4s ease;
            text-decoration: none;
            display: inline-block;
            letter-spacing: 1px;
        }

        .explore-btn:hover:not(:disabled) {
            background: #d4af37;
            color: #000;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(212, 175, 55, 0.3);
        }

        .explore-btn:active {
            transform: translateY(0);
        }

        /* Marker styles */
        .custom-marker .marker-pin {
            font-size: 20px;
            line-height: 1;
            color: #8b0000;
            text-shadow: 0 1px 0 rgba(255,255,255,0.6), 0 2px 6px rgba(0,0,0,0.15);
            transform: translateY(-2px);
            display: inline-block;
        }
        .custom-marker { transform: translate(-50%, -100%); }

        /* Responsive */
        @media (max-width: 768px) {
            .main-title { font-size: 2.5rem; letter-spacing: 6px; }
            .tagline { font-size: 0.85rem; letter-spacing: 2px; }
            .detail-card { padding: 20px 25px; }
            .explore-btn { padding: 10px 20px; font-size: 0.9rem; }
            .button-group { gap: 8px; }
        }

        @media (max-width: 480px) {
            .main-title { font-size: 2rem; letter-spacing: 4px; }
            .tagline { font-size: 0.75rem; }
            .detail-card { padding: 15px 20px; }
            .explore-btn { padding: 10px 16px; font-size: 0.85rem; }
        }
    </style>
</head>
<body>
    <div id="map"></div>

    <div class="landing-container">
        <header>
            <h1 class="main-title">KE≈ûƒ∞F PANELƒ∞</h1>
            <p class="tagline">Dijital Varlƒ±klarƒ±n G√∂r√ºnmez ƒ∞zleri</p>
        </header>

        <div class="detail-card">
            <p>Ke≈üif Paneli ‚Äî dijital varlƒ±klarƒ±n g√∂r√ºnmez izlerini izleme aracƒ±. <span style="color:#d4af37;font-family:'Cinzel';">ayƒ±n altƒ±nƒ±sƒ±</span> stilinde vurgu uygulanmƒ±≈ütƒ±r.</p>
        </div>

        <div class="button-group">
            <button onclick="runDiscovery()" class="explore-btn" id="actionBtn">KE≈ûFE BA≈ûLA</button>
            <a href="frontend/map.html" class="explore-btn">HARITA</a>
            <a href="frontend/posts.html" class="explore-btn">SON PAYLA≈ûIMLAR</a>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // Initialize map
        var map = L.map('map', {
            zoomControl: false,
            dragging: true,
            touchZoom: true,
            scrollWheelZoom: true
        }).setView([39.0, 35.2], 6);

        L.control.zoom({ position: 'bottomright' }).addTo(map);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

        var markers = [];
        var posts = [];

        // HTML to text converter
        function htmlToText(html){
            const div = document.createElement('div');
            div.innerHTML = html || '';
            return div.textContent || div.innerText || '';
        }

        // Load WordPress posts and render markers
        async function loadPostsAndMarkers() {
            try {
                const response = await fetch('https://sarpkantman.com/wp-json/wp/v2/posts?per_page=100&_fields=id,title,excerpt,content,meta,link,date');
                let wpPosts = await response.json();

                if (wpPosts && Array.isArray(wpPosts) && wpPosts.length > 0) {
                    wpPosts = wpPosts.map((post, index) => ({
                        ...post,
                        wp_id: post.id,
                        id: 100 + index,
                        latitude: post.meta?.latitude || null,
                        longitude: post.meta?.longitude || null,
                        location: post.meta?.location || post.meta?.country || null
                    }));

                    // Map first two posts to Corleone and Rashid
                    if (wpPosts[0]) {
                        wpPosts[0].location = 'Corleone, Sicilya, ƒ∞talya';
                        wpPosts[0].latitude = wpPosts[0].latitude || 37.7722;
                        wpPosts[0].longitude = wpPosts[0].longitude || 13.3055;
                    }
                    if (wpPosts[1]) {
                        wpPosts[1].location = 'Rashid, Mƒ±sƒ±r';
                        wpPosts[1].latitude = wpPosts[1].latitude || 31.2753;
                        wpPosts[1].longitude = wpPosts[1].longitude || 30.4265;
                    }

                    posts = wpPosts;
                } else {
                    // Fallback posts
                    posts = [
                        {
                            id: 1,
                            title: { rendered: 'Corleone' },
                            location: 'Corleone, Sicilya, ƒ∞talya',
                            latitude: 37.7722,
                            longitude: 13.3055
                        },
                        {
                            id: 2,
                            title: { rendered: 'Rashid' },
                            location: 'Rashid, Mƒ±sƒ±r',
                            latitude: 31.2753,
                            longitude: 30.4265
                        }
                    ];
                }
            } catch (err) {
                console.error("Posts load error:", err);
                posts = [
                    {
                        id: 1,
                        title: { rendered: 'Corleone' },
                        location: 'Corleone, Sicilya, ƒ∞talya',
                        latitude: 37.7722,
                        longitude: 13.3055
                    },
                    {
                        id: 2,
                        title: { rendered: 'Rashid' },
                        location: 'Rashid, Mƒ±sƒ±r',
                        latitude: 31.2753,
                        longitude: 30.4265
                    }
                ];
            }

            renderMarkers();
        }

        function renderMarkers() {
            markers.forEach(m => map.removeLayer(m));
            markers = [];

            posts.forEach(post => {
                const latitude = post.latitude || post.meta?.latitude;
                const longitude = post.longitude || post.meta?.longitude;

                if (latitude && longitude) {
                    const titleText = htmlToText(post.title?.rendered || '');
                    const icon = L.divIcon({ 
                        className: 'custom-marker', 
                        html: `<div class="marker-pin" title="${titleText}">üìç</div>` 
                    });
                    var marker = L.marker([latitude, longitude], { icon: icon }).addTo(map);
                    markers.push(marker);
                }
            });
        }

        function runDiscovery(){
            // Redirect to map page
            window.location.href = 'frontend/map.html';
        }

        // Load posts on page init
        loadPostsAndMarkers();
    </script>
</body>
</html>