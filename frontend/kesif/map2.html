<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Keşif: Map2</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&family=Fauna+One&display=swap" rel="stylesheet">
    <style>
        body { margin: 0; display: flex; height: 100vh; background: #fdfaf3; overflow: hidden; font-family: 'Fauna One', serif; }
        #map { flex-grow: 1; height: 100%; z-index: 1; }
        #sidebar-left { width: 320px; background: #f4f1ea; border-right: 3px solid #d4af37; padding: 24px; z-index: 1000; box-shadow: 5px 0 15px rgba(0,0,0,0.1); overflow-y: auto; height: 100vh; position: fixed; left: 0; top: 0; transition: transform 0.4s ease-in-out; }
        #sidebar-left.closed { transform: translateX(-100%); }
        .sidebar-title { font-family: 'Cinzel', serif; color: #8b0000; border-bottom: 2px solid #d4af37; margin-bottom: 18px; padding-bottom: 10px; font-size: 1.1rem; }
        .single-post { background: #fff; border: 1px solid #e0e0e0; padding: 16px; border-left: 3px solid #d4af37; cursor: pointer; transition: all 0.25s ease; }
        .single-post:hover { background: #fff7e6; border-left-color: #8b0000; transform: translateX(4px); box-shadow: 0 6px 16px rgba(139,0,0,0.08); }
        .single-post-title { font-family: 'Cinzel', serif; color: #8b0000; font-size: 0.95rem; margin: 0 0 8px 0; }
        .single-post-sub { font-size: 0.8rem; color: #555; }
        .back-home { display: block; text-align: center; margin-top: 24px; padding-top: 12px; border-top: 1px solid rgba(212,175,55,0.3); color: #8b0000; text-decoration: none; font-family: 'Cinzel'; font-size: 0.9rem; border-bottom: 1px solid #d4af37; }
        #toggle-sidebar { position: absolute; right: 10px; top: 10px; background: transparent; border: 1px solid #d4af37; color: #8b0000; cursor: pointer; font-size: 1.2rem; padding: 5px 10px; transition: all 0.3s ease; -webkit-user-select: none; user-select: none; }
        #toggle-sidebar:active { transform: scale(0.95); }
        #open-sidebar { position: fixed; left: 10px; top: 20px; z-index: 999; background: #f4f1ea; border: 2px solid #d4af37; color: #8b0000; padding: 10px 15px; cursor: pointer; box-shadow: 2px 2px 10px rgba(0,0,0,0.2); font-weight: bold; transition: all 0.3s ease; display: none; -webkit-user-select: none; user-select: none; }
        #open-sidebar:active { transform: scale(0.95); }
    </style>
</head>
<body>
    <div id="sidebar-left">
        <button id="toggle-sidebar" onclick="toggleSidebar()" aria-label="Sol paneli kapat">❮</button>
        <h2 class="sidebar-title">KEŞFE BAŞLA</h2>
        <div id="customPostsList">Yükleniyor...</div>
        <a href="../../index.html" class="back-home">Ana Sayfaya Dön</a>
    </div>
    <button id="open-sidebar" onclick="toggleSidebar()" style="display:none;">❯</button>
    <!-- Sidebar dinamik yükleme ve aktif_linkler tanımı -->
    <script>
        // Caesar.html'deki gibi sadece belirli sayfaları gösteren dinamik sidebar
        const customPages = [
            {
                url: 'https://sarpkantman.com/bir-nehir-bir-cumle-bir-imparatorluk-zar-atildi',
                slug: 'bir-nehir-bir-cumle-bir-imparatorluk-zar-atildi',
                sub: "Rubicon'u geçen karar",
                local: 'caesar.html'
            },
            {
                url: 'https://sarpkantman.com/tag/d-day',
                slug: '“Normandiya Çıkarması Başarısız Olsaydı Ne Olurdu?”',
                sub: `6 Haziran 1944’te Müttefikler Normandiya’ya çıkarma yaptı. Ancak bu dev operasyon, Alman savunması ve kötü hava koşulları nedeniyle her an başarısız olabilirdi. Omaha Plajı’ndaki kanlı çarpışmalar, özgürlük ile yenilgi arasındaki ince çizgiyi gösterdi. Peki, çıkartma başarısız olsaydı dünya nasıl değişirdi? Bu yazıda, askeri tarihçi <b>David Smith’in</b> analiziyle, Normandiya Çıkarması’nın başarısız olması halinde Batı dünyasının karşılaşabileceği alternatif geleceği keşfedeceksiniz.`,
                local: 'd-day.html'
            }
        ];

        async function fetchCustomSidebar() {
            const container = document.getElementById('customPostsList');
            let html = '';
            for (const page of customPages) {
                try {
                    let title = '';
                    if (page.url.includes('/tag/')) {
                        title = '“Normandiya Çıkarması Başarısız Olsaydı Ne Olurdu?”';
                    } else {
                        const resp = await fetch(`https://sarpkantman.com/wp-json/wp/v2/posts?slug=${page.slug}`);
                        const data = await resp.json();
                        title = data && data[0] && data[0].title && data[0].title.rendered ? data[0].title.rendered : page.slug;
                    }
                    if (page.local) {
                        html += `<div class="single-post" onclick="window.location.href='${page.local}'">
                            <div class="single-post-title">${title}</div>
                            <div class="single-post-sub">${page.sub}</div>
                        </div>`;
                    } else {
                        html += `<div class="single-post" onclick="window.open('${page.url}','_blank')">
                            <div class="single-post-title">${title}</div>
                            <div class="single-post-sub">${page.sub}</div>
                        </div>`;
                    }
                } catch (e) {
                    html += `<div class="single-post"><div class="single-post-title">${page.slug}</div><div class="single-post-sub">(Başlık alınamadı)</div></div>`;
                }
            }
            container.innerHTML = html;
        }
        fetchCustomSidebar();
    </script>
    <div id="map"></div>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
        <script>
        // Kronoloji veri dizisi
        const caesarRoute = [
            {
                year: 'MÖ 49',
                location: 'Ravenna, İtalya',
                description: 'Sezar ordusunu burada topladı ve son kararını verdi.',
                lat: 44.4184,
                lon: 12.2035
            },
            {
                year: 'MÖ 49',
                location: 'Rubicon, Kuzey İtalya',
                description: 'Roma Cumhuriyeti için geri dönüş olmayan eşik.',
                lat: 44.0140,
                lon: 12.2310
            },
            {
                year: 'MÖ 49',
                location: 'Rimini, İtalya',
                description: 'Sezar, Rubicon sonrası ilk büyük kente girdi.',
                lat: 44.0678,
                lon: 12.5695
            },
            {
                year: 'MÖ 49',
                location: 'Arezzo, İtalya',
                description: 'Roma yolu üzerinde kritik bir askeri durak.',
                lat: 43.4643,
                lon: 11.8796
            },
            {
                year: 'MÖ 49',
                location: 'Roma, İtalya',
                description: 'Siyasi gücün merkezine doğru son yürüyüş.',
                lat: 41.9028,
                lon: 12.4964
            }
        ];

        // Kronoloji fonksiyonu: step.name yerine step.location kullan
        function updateStep(index) {
            const step = caesarRoute[index];
            if (!step) return;
            if (typeof caesarMarker !== 'undefined') caesarMarker.setLatLng([step.lat, step.lon]);
            if (typeof map !== 'undefined') map.flyTo([step.lat, step.lon], 8, { animate: true, duration: 1.2 });
            // HTML elementlerine veri basımı
            document.getElementById('caesarTimelineLabel') && (document.getElementById('caesarTimelineLabel').textContent = step.location);
            document.getElementById('caesarInfoTitle') && (document.getElementById('caesarInfoTitle').textContent = step.location);
            document.getElementById('caesarInfoMeta') && (document.getElementById('caesarInfoMeta').textContent = step.year + ' · ' + step.location);
            document.getElementById('caesarInfoText') && (document.getElementById('caesarInfoText').textContent = step.description);
            document.getElementById('caesarInfoCard') && (document.getElementById('caesarInfoCard').style.display = 'block');
        }

        // Harita ve marker kontrolüyle route'u başlat
        function activateRoute() {
            if (typeof map === 'undefined' || typeof caesarMarker === 'undefined') return;
            if (!window.routeActive) {
                if (typeof routeLine !== 'undefined') routeLine.addTo(map);
                caesarMarker.addTo(map);
                window.routeActive = true;
            }
        }

        window.onload = function() {
            // Sidebar dinamik yükleme (ileride sidebar.ghtml'den)
            // fetch('sidebar.ghtml').then(r => r.text()).then(t => { document.getElementById('sidebar-dynamic').innerHTML = t; });

            // URL kontrolü
            const params = new URLSearchParams(window.location.search);
            const fromMap2 = params.get('from') === 'map2';
            var sidebar = document.getElementById('sidebar-left');
            var openBtn = document.getElementById('open-sidebar');
            if (fromMap2) {
                if (sidebar) sidebar.classList.add('closed');
                if (openBtn) openBtn.style.display = 'block';
                // Bilgi kartı overlay'i aç
                var overlay = document.getElementById('caesarOverlay');
                if (overlay) overlay.style.display = 'flex';
                // Kronoloji ve info kartı gizle
                var timeline = document.getElementById('caesarTimeline');
                var infoCard = document.getElementById('caesarInfoCard');
                if (timeline) timeline.style.display = 'none';
                if (infoCard) infoCard.style.display = 'none';
                // Devam butonuna click event
                var devambtn = document.getElementById('caesarOverlayClose');
                if (devambtn) {
                    devambtn.onclick = function() {
                        if (overlay) overlay.style.display = 'none';
                        if (timeline) timeline.style.display = 'flex';
                        if (infoCard) infoCard.style.display = 'block';
                        activateRoute();
                        updateStep(0);
                    }
                }
            }
        }
        // ...existing code...
        </script>
    <script>
        var map = L.map('map', { zoomControl: false }).setView([39.0, 35.2], 6);
        L.control.zoom({ position: 'bottomright' }).addTo(map);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
        function toggleSidebar() {
            var sidebar = document.getElementById('sidebar-left');
            var openBtn = document.getElementById('open-sidebar');
            if (sidebar.classList.contains('closed')) {
                sidebar.classList.remove('closed');
                openBtn.style.display = 'none';
            } else {
                sidebar.classList.add('closed');
                openBtn.style.display = 'block';
            }
        }
    </script>
</body>
</html>
