<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>D-Day: Normandiya | Keşfe Başla</title>

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&family=Fauna+One&display=swap" rel="stylesheet">

    <style>
        :root {
            --ally-blue: #2c3e50;
            --axis-gray: #4b4b4b;
            --gold: #d4af37;
            --sand: #fdfaf3;
        }

        body { margin: 0; display: flex; height: 100vh; background: var(--sand); overflow: hidden; font-family: 'Fauna One', serif; }
        #map { flex-grow: 1; height: 100%; z-index: 1; }

          #sidebar-left {
            width: 320px;
            background: #f4f1ea;
            border-right: 3px solid var(--gold);
            padding: 24px;
            z-index: 1000;
            box-shadow: 5px 0 15px rgba(0,0,0,0.1);
            overflow-y: auto;
            height: 100vh;
            position: fixed;
            left: 0;
            top: 0;
            transition: transform 0.4s ease-in-out;
        }

        #sidebar-left.closed {
            transform: translateX(-100%);
        }

        .sidebar-title {
            font-family: 'Cinzel', serif;
            color: var(--deep);
            border-bottom: 2px solid var(--gold);
            margin-bottom: 18px;
            padding-bottom: 10px;
            font-size: 1.1rem;
        }

#toggle-sidebar {
            position: absolute;
            right: 10px;
            top: 10px;
            background: transparent;
            border: 1px solid var(--gold);
            color: var(--deep);
            cursor: pointer;
            font-size: 1.2rem;
            padding: 5px 10px;
            transition: all 0.3s ease;
            -webkit-user-select: none;
            user-select: none;
        }

        #toggle-sidebar:active {
            transform: scale(0.95);
        }

        #toggle-sidebar:focus-visible,
        #open-sidebar:focus-visible,
        #caesarOverlayClose:focus-visible,
        .caesar-info-btn:focus-visible {
            outline: 2px solid var(--gold);
            outline-offset: 2px;
        }

        #open-sidebar {
            position: fixed;
            left: 10px;
            top: 20px;
            z-index: 999;
            background: #f4f1ea;
            border: 2px solid var(--gold);
            color: var(--deep);
            padding: 10px 15px;
            cursor: pointer;
            box-shadow: 2px 2px 10px rgba(0,0,0,0.2);
            font-weight: bold;
            transition: all 0.3s ease;
            display: none;
            -webkit-user-select: none;
            user-select: none;
        }

        #open-sidebar:active {
            transform: scale(0.95);
        }

        /* Timeline ve Kart Tasarımı (Senin Sezar kodunla uyumlu) */
        #ddayTimeline {
            position: fixed; right: 24px; top: 50%; transform: translateY(-50%);
            height: 60vh; width: 64px; z-index: 2500; display: flex; align-items: center; justify-content: center;
        }
        .timeline-track {
            position: absolute; left: 50%; top: 0; transform: translateX(-50%);
            width: 4px; height: 100%; background: linear-gradient(180deg, var(--ally-blue), var(--axis-gray));
            border-radius: 10px;
        }
        #ddaySlider {
            -webkit-appearance: none; appearance: none; width: 60vh; height: 24px;
            transform: rotate(-90deg); background: transparent; z-index: 2; cursor: pointer;
        }
        
        .info-card {
            position: fixed; right: 120px; top: 50%; transform: translateY(-50%);
            width: 360px; background: #fff; border: 2px solid var(--gold);
            border-radius: 10px; box-shadow: 0 18px 40px rgba(0,0,0,0.2);
            z-index: 2400; display: block; overflow: hidden;
        }
        .card-header { padding: 12px; background: #f4f1ea; font-family: 'Cinzel'; color: var(--ally-blue); border-bottom: 1px solid var(--gold); }
        .card-body { padding: 15px; font-size: 0.9rem; line-height: 1.6; }
        .side-badge { 
            display: inline-block; padding: 2px 8px; border-radius: 4px; 
            font-size: 0.7rem; font-weight: bold; color: white; margin-bottom: 10px;
        }
        .ally { background: #2980b9; }
        .axis { background: #c0392b; }
    </style>
</head>
<body>

    <div id="map"></div>

    <div id="ddayTimeline">
        <div class="timeline-track"></div>
        <input id="ddaySlider" type="range" min="0" max="4" value="0" step="1">
    </div>

    <div id="infoCard" class="info-card">
        <div class="card-header" id="eventTitle">D-Day Hazırlıkları</div>
        <div class="card-body">
            <div id="sideBadge" class="side-badge ally">MÜTTEFİK</div>
            <div id="eventMeta" style="font-weight: bold; margin-bottom: 5px;">6 Haziran 1944 · 00:15</div>
            <div id="eventDesc">Paraşütçü birlikleri (101. ve 82. Hava İndirme) Normandiya'nın iç kesimlerine iniş yapmaya başladı.</div>
        </div>
    </div>

    <div id="sidebar-left">
        <button id="toggle-sidebar" onclick="toggleSidebar()" aria-label="Sol paneli kapat">❮</button>
        <h2 class="sidebar-title">KEŞFE BAŞLA</h2>
        <div id="customPostsList">Yükleniyor...</div>
        <a href="../index.html" class="back-home">Ana Sayfaya Dön</a>
    </div>
    <button id="open-sidebar" onclick="toggleSidebar()" aria-label="Sol paneli aç">❯</button>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        const ddayData = [
            {
                title: "Hava İndirme Harekatı",
                side: "ally",
                time: "00:15",
                location: "Sainte-Mère-Église",
                desc: "101. ve 82. Hava İndirme tümenleri, karaya çıkacak birliklerin arkasını sağlama almak için atlayış yaptı.",
                lat: 49.4089, lon: -1.3174
            },
            {
                title: "Atlantik Duvarı Savunması",
                side: "axis",
                time: "03:00",
                location: "Pointe du Hoc",
                desc: "Alman bataryaları alarm durumuna geçti. Erwin Rommel'in inşa ettirdiği engeller ve sığınaklar hazır bekliyor.",
                lat: 49.3974, lon: -0.9894
            },
            {
                title: "Omaha Plajı Cehennemi",
                side: "ally",
                time: "06:30",
                location: "Omaha Beach",
                desc: "En kanlı çarpışmalar burada yaşandı. 'Er Ryan'ı Kurtarmak' filminin geçtiği o meşhur sahil.",
                lat: 49.3697, lon: -0.8711
            },
            {
                title: "Gold, Juno ve Sword Plajları",
                side: "ally",
                time: "07:30",
                location: "Arromanches",
                desc: "İngiliz ve Kanada birlikleri yapay limanlar (Mulberry Harbours) inşa etmek üzere çıkarma yaptı.",
                lat: 49.3444, lon: -0.6220
            },
            {
                title: "Alman Karşı Taarruzu",
                side: "axis",
                time: "16:00",
                location: "Caen",
                desc: "21. Panzer Tümeni Müttefikleri durdurmak için karşı saldırıya geçti ancak hava desteği eksikliğiyle geri çekildi.",
                lat: 49.1829, lon: -0.3708
            }
        ];

        const map = L.map('map').setView([49.3, -0.7], 9);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

        const slider = document.getElementById('ddaySlider');
        const titleEl = document.getElementById('eventTitle');
        const descEl = document.getElementById('eventDesc');
        const metaEl = document.getElementById('eventMeta');
        const badgeEl = document.getElementById('sideBadge');

        function updateDDay(index) {
            const data = ddayData[index];
            map.flyTo([data.lat, data.lon], 11);
            
            titleEl.textContent = data.title;
            descEl.textContent = data.desc;
            metaEl.textContent = `6 Haziran 1944 · ${data.time}`;
            
            badgeEl.textContent = data.side === "ally" ? "MÜTTEFİK" : "MIHVER";
            badgeEl.className = `side-badge ${data.side}`;

            // İşaretçi ekleme
            L.circleMarker([data.lat, data.lon], {
                color: data.side === "ally" ? 'blue' : 'red',
                radius: 10
            }).addTo(map).bindPopup(data.title).openPopup();
        }

        slider.addEventListener('input', (e) => updateDDay(e.target.value));
        
        // İlk yükleme
        window.onload = function() {
            var sidebar = document.getElementById('sidebar-left');
            var openBtn = document.getElementById('open-sidebar');
            if (sidebar) sidebar.classList.add('closed'); // Her zaman kapalı başlat
            if (openBtn) openBtn.style.display = 'block'; // Ok butonu her zaman görünüyor
            fetchCustomSidebar();
            updateDDay(0);
        };

        async function fetchCustomSidebar() {
            const container = document.getElementById('customPostsList');
            let html = '';
            const customPages = [
                {
                    url: 'https://sarpkantman.com/bir-nehir-bir-cumle-bir-imparatorluk-zar-atildi',
                    slug: 'bir-nehir-bir-cumle-bir-imparatorluk-zar-atildi',
                    sub: "Rubicon'u geçen karar",
                    local: 'caesar.html'
                },
                {
                    url: 'https://sarpkantman.com/tag/d-day',
                    slug: 'd-day',
                    sub: "II. Dünya Savaşı",
                    local: 'd-day.html'
                }
            ];
            for (const page of customPages) {
                try {
                    let title = '';
                    if (page.url.includes('/tag/')) {
                        title = 'D-Day ve Normandiya';
                    } else {
                        const resp = await fetch(`https://sarpkantman.com/wp-json/wp/v2/posts?slug=${page.slug}`);
                        const data = await resp.json();
                        title = data && data[0] && data[0].title && data[0].title.rendered ? data[0].title.rendered : page.slug;
                    }
                    if (page.local) {
                        html += `<div class="single-post" onclick="window.location.href='${page.local}'">
                            <div class="single-post-title">${title}</div>
                            <div class="single-post-sub">${page.sub}</div>
                        </div>`;
                    } else {
                        html += `<div class="single-post" onclick="window.open('${page.url}','_blank')">
                            <div class="single-post-title">${title}</div>
                            <div class="single-post-sub">${page.sub}</div>
                        </div>`;
                    }
                } catch (e) {
                    html += `<div class="single-post"><div class="single-post-title">${page.slug}</div><div class="single-post-sub">(Başlık alınamadı)</div></div>`;
                }
            }
            container.innerHTML = html;
        }

        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar-left');
            const openBtn = document.getElementById('open-sidebar');
            sidebar.classList.toggle('closed');
            if (sidebar.classList.contains('closed')) {
                setTimeout(() => { if (openBtn) openBtn.style.display = 'block'; }, 300);
            } else {
                if (openBtn) openBtn.style.display = 'none';
            }
            setTimeout(() => {
                if (typeof map !== 'undefined') {
                    map.invalidateSize();
                }
            }, 400);
        }
    </script>
</body>
</html>